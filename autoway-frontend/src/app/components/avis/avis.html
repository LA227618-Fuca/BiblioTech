<app-navbar></app-navbar>

<main class="py-5">
  <div class="container">
    <div class="row g-4">
      @if (authService.isAuthenticated()) {
        <div class="col-lg-6">
          <h4 class="text-warning">Laisser un avis</h4>
          <p class="text-muted">Votre retour nous aide à améliorer le service.</p>

          @if (error) {
            <div class="alert alert-danger">{{ error }}</div>
          }

          <form (ngSubmit)="onSubmit()">
            <div class="mb-3">
              <label class="form-label text-light">Réservation</label>
              <select class="form-select avis-select"
                      [(ngModel)]="newAvis.reservationID"
                      name="reservationID"
                      required>
                <option [value]="0" class="text-muted">Sélectionner une réservation</option>
                @for (reservation of reservations; track reservation.reservationID) {
                  <option [value]="reservation.reservationID" class="text-light">
                    Réservation #{{ reservation.reservationID }} - {{ reservation.dateDebut }} à {{ reservation.dateFin }}
                  </option>
                }
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label text-light">Note</label>
              <select class="form-select avis-select"
                      [(ngModel)]="newAvis.score"
                      name="score"
                      required>
                <option [value]="5" class="text-light">5 — Excellent</option>
                <option [value]="4" class="text-light">4 — Très bien</option>
                <option [value]="3" class="text-light">3 — Bien</option>
                <option [value]="2" class="text-light">2 — Moyen</option>
                <option [value]="1" class="text-light">1 — Mauvais</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Commentaire</label>
              <textarea class="form-control bg-secondary bg-opacity-10 border-secondary text-light" 
                        rows="5" 
                        placeholder="Racontez-nous votre expérience..."
                        [(ngModel)]="newAvis.message"
                        name="message"></textarea>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-warning">Envoyer l'avis</button>
            </div>
          </form>
        </div>
      }

      <div [class]="authService.isAuthenticated() ? 'col-lg-6' : 'col-lg-12'">
        <h4 class="text-warning">Avis récents</h4>

        <div class="list-group mt-3">
          @for (avisItem of avis; track avisItem.avisID) {
            <div class="list-group-item bg-dark border-secondary text-light mb-2">
              <div class="d-flex justify-content-between">
                <div>
                  <strong>Avis #{{ avisItem.avisID }}</strong>
                  <div class="small text-warning">{{ getStars(avisItem.score) }}</div>
                </div>
                <div class="text-muted small">{{ avisItem.datePublication }}</div>
              </div>
              <p class="mb-0 text-muted">{{ avisItem.message || 'Avis sans commentaire' }}</p>
            </div>
          }
          @if (avis.length === 0) {
            <p class="text-muted">Aucun avis pour le moment.</p>
          }
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="pt-4 pb-3 border-top border-secondary">
  <div class="container d-flex justify-content-between text-muted">
    <small>© 2025 AutoWay</small>
    <div>
      <a href="#" class="text-muted me-3">Mentions légales</a>
      <a href="#" class="text-muted">Contact</a>
    </div>
  </div>
</footer>
